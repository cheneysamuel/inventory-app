<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="app-components.css">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="ext_lib/jquery-3.6.0.min.js"></script>
    <script src="ext_lib/select2.min.js"></script>
    <link rel="stylesheet" href="ext_lib/select2.min.css">
    <script src="ext_lib/xlsx.full.min.js"></script>
    <script src="ext_lib/exceljs.min.js"></script>
    <script src="ext_lib/pdf-lib.min.js"></script>
    <script src="ext_lib/signature_pad.umd.min.js"></script>
</head>
<body>
    <!-- Loading Screen (shown while checking authentication) -->
    <div id="loading-screen" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); align-items: center; justify-content: center; z-index: 9999;">
        <div style="text-align: center; color: white;">
            <h1 style="margin-bottom: 1rem;">ğŸ” Checking Authentication...</h1>
            <div style="font-size: 2rem;">â³</div>
        </div>
    </div>
    
    <!-- Change Password Modal -->
    <div id="change-password-modal" class="auth-overlay" style="display: none;">
        <div class="auth-container" style="max-width: 450px;">
            <h2>Change Password</h2>
            <p style="color: #666; margin-bottom: 1.5rem;">Enter your current password and choose a new password.</p>
            
            <form id="change-password-form">
                <div class="form-group">
                    <label for="current-password">Current Password</label>
                    <input type="password" id="current-password" class="form-control" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                </div>
                
                <div class="form-group">
                    <label for="new-password">New Password</label>
                    <input type="password" id="new-password" class="form-control" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                    <small style="color: #666; display: block; margin-top: 0.25rem;">Minimum 6 characters</small>
                </div>
                
                <div class="form-group">
                    <label for="confirm-new-password">Confirm New Password</label>
                    <input type="password" id="confirm-new-password" class="form-control" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                </div>
                
                <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                    <button type="button" id="cancel-password-change-btn" class="btn btn-secondary" style="flex: 1;">Cancel</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Update Password</button>
                </div>
                
                <div id="change-password-error" class="alert alert-error" style="display: none; margin-top: 1rem;"></div>
                <div id="change-password-success" class="alert alert-success" style="display: none; margin-top: 1rem;"></div>
            </form>
        </div>
    </div>

    <!-- Main Application (shown after authentication) -->
    <div id="app" style="display: none;">
        <!-- Sidebar Navigation -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h2>Inventory System</h2>
                <div id="user-info" class="user-info">
                    <div class="user-dropdown">
                        <button id="user-menu-btn" class="user-menu-btn">
                            <strong id="user-email" class="user-email-text"></strong>
                            <svg class="user-menu-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M2 4h12v1.5H2V4zm0 4h12v1.5H2V8zm0 4h12v1.5H2V12z"/>
                            </svg>
                        </button>
                        <div id="user-dropdown-menu" class="user-dropdown-menu" style="display: none;">
                            <button id="change-password-btn" class="user-dropdown-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 0.5rem;">
                                    <path d="M8 1a3.5 3.5 0 0 0-3.5 3.5V7H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1h-1.5V4.5A3.5 3.5 0 0 0 8 1zm2 6V4.5a2 2 0 1 0-4 0V7h4z"/>
                                </svg>
                                Change Password
                            </button>
                            <button id="logout-btn" class="user-dropdown-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 0.5rem;">
                                    <path d="M10 2v2h3v8h-3v2h5V2h-5zM7 4L3 8l4 4v-3h6V7H7V4z"/>
                                </svg>
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="context-selectors">
                <div class="form-group">
                    <label for="clientSelect">Client:</label>
                    <select id="clientSelect" class="form-control">
                        <option value="">Select Client</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="marketSelect">Market:</label>
                    <select id="marketSelect" class="form-control">
                        <option value="">Select Market</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="slocSelect">SLOC:</label>
                    <select id="slocSelect" class="form-control">
                        <option value="">Select SLOC</option>
                    </select>
                </div>
            </div>
            
            <div class="nav-section">
                <h3>Main Operations</h3>
                <button class="nav-btn" data-view="dashboard">ğŸ“Š Dashboard</button>
                <button class="nav-btn" data-view="receive-serialized">ğŸ”¢ Manage Serialized Items</button>
                <button class="nav-btn" data-view="receive-bulk">ğŸ“¦ Rcv/Issue Bulk Items</button>
                <button class="nav-btn" data-view="inventory-view">ğŸ“‹ Manage Bulk Items</button>
                <button class="nav-btn" data-view="transactions">ğŸ“œ Transactions</button>
            </div>
            
            <div class="nav-section">
                <h3>Configuration</h3>
                <button class="nav-btn" data-view="preferences">âš™ï¸ Preferences</button>
                <button class="nav-btn" data-view="manage-items">ğŸ”§ Item Types</button>
                <button class="nav-btn" data-view="manage-crews">ğŸ‘¥ Crews</button>
                <button class="nav-btn" data-view="manage-areas">ğŸ¢ Clients/Markets/SLOCs/Areas</button>
            </div>
            
            <div class="nav-section">
                <h3>Import/Export</h3>
                <button class="nav-btn" data-view="export">ğŸ“Š Export Data</button>
                <button class="nav-btn" data-view="import">ğŸ“¥ Import Data</button>
            </div>
        </nav>
        
        <!-- Main Content Area -->
        <main id="main-content" class="main-content">
            <div id="view-container"></div>
        </main>
    </div>
    
    <!-- Modal Container -->
    <div id="modal-container"></div>
    
    <!-- Toast Notification Container -->
    <div id="toast-container"></div>
    
    <!-- Application Scripts (Order matters for functional composition) -->
    <script src="js/config/supabase.config.js"></script>
    <script src="js/utils/functional.js"></script>
    <script src="js/utils/dom.js"></script>
    <script src="js/db/database.js"></script>
    <script src="js/db/queries.js"></script>
    <script src="js/db/consolidation.js"></script>
    <script src="js/state/store.js"></script>
    <script src="js/ui/components.js"></script>
    <script src="js/ui/modals.js"></script>
    <script src="js/ui/views.js"></script>
    <script src="js/services/auth.js"></script>
    <script src="js/services/transactions.js"></script>
    <script src="js/services/validation.js"></script>
    <script src="js/services/import-item-types.js"></script>
    <script src="js/services/import-inventory.js"></script>
    <script src="js/services/import-new-inventory.js"></script>
    <script src="js/services/import-export.js"></script>
    <script src="js/services/inventory-actions.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
